include required(classpath("application"))

engine {
  filesystems {
    gcs {
      auth = "application-default"
      }
  }
}

backend.providers.Local.config.filesystems {
	gcs {
		auth = "application-default"
	}
}

backend {
  # Override the default backend.
  default = PAPIv2

  providers {
    PAPIv2 {
      actor-factory = "cromwell.backend.google.pipelines.v2beta.PipelinesApiLifecycleActorFactory"
      config {
        project = "broad-dsde-methods"

        root = "gs://palantir-workflows-test-execution"

        name-for-call-caching-purposes: PAPI

        slow-job-warning-time: 24 hours

        genomics {
          auth = "application-default"

          endpoint-url = "https://lifesciences.googleapis.com/"

          location = "us-central1"

          parallel-composite-upload-threshold="150M"
        }
       
        filesystems {
          gcs {
            auth = "application-default"
          }
        }

        default-runtime-attributes {
          cpu: 1
          failOnStderr: false
          continueOnReturnCode: 0
          memory: "2048 MB"
          bootDiskSizeGb: 10
          disks: "local-disk 10 SSD"
          noAddress: false
          preemptible: 0
          zones: ["us-central1-a", "us-central1-b"]
        }

        include "papi_v2_reference_image_manifest.conf"
      }
    }
  }
}
