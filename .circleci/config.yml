# CircleCI 2.1 configuration file
#
#
version: 2.1
executors:
  womtool-executor:
    docker:
      # specify the version you desire here
      - image: broadinstitute/womtool:47-b36d920
        entrypoint: /bin/bash
    working_directory: ~/palantir-workflows

  cromwell-executor:
    docker:
      - image: broadinstitute/cromwell:47-b36d920
        entrypoint: /bin/bash
    working_directory: ~/palantir-workflows

jobs:
  validate:
    executor: womtool-executor
    parameters:
      wdl:
        type: string
    steps:
      - checkout
      - run: java -jar /app/womtool.jar validate << parameters.wdl >>

  validate-with-json:
    executor: womtool-executor
    parameters:
      wdl:
        type: string
      input-json:
        type: string
    steps:
      - checkout
      - run: java -jar /app/womtool.jar validate << parameters.wdl >> -i << parameters.input-json >>

  test:
    executor: cromwell-executor
    parameters:
      wdl:
        type: string
      input-json:
        type: string
    steps:
      - checkout
      - run: java -jar /app/cromwell.jar run << parameters.wdl >> -i << parameters.input-json >>

workflows:
  version: 2
  validate-and-test:
    jobs:
      - validate-with-json:
          wdl: "~/BenchmarkVCFs/BenchmarkVCFs.wdl"
          input-json: "test/BenchmarkVCFs/BenchmarkVCFs.wdl.validate.json"
          name: "validate-BenchmarkVCFs"
      - test:
          wdl: "BenchmarkVCFs/BenchmarkVCFs.wdl"
          input-json: "test/BenchmarkVCFs/BenchmarkVCFs.wdl.test.json"
          requires:
            - validate-BenchmarkVCFs

